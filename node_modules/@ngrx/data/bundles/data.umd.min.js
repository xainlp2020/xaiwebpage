/**
 * @license NgRx 9.0.0
 * (c) 2015-2018 Brandon Roberts, Mike Ryan, Rob Wormald, Victor Savkin
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tslib"),require("@angular/core"),require("rxjs/operators"),require("@angular/common/http"),require("rxjs"),require("@ngrx/entity"),require("@ngrx/store"),require("@ngrx/effects")):"function"==typeof define&&define.amd?define("@ngrx/data",["exports","tslib","@angular/core","rxjs/operators","@angular/common/http","rxjs","@ngrx/entity","@ngrx/store","@ngrx/effects"],e):e(((t=t||self).ngrx=t.ngrx||{},t.ngrx.data={}),t.tslib,t.ng.core,t.rxjs.operators,t.ng.common.http,t.rxjs,t.ngrx.entity,t.ngrx.store,t.ngrx.effects)}(this,(function(t,e,r,n,i,a,s,o,c){"use strict";var p,u=function(){function t(){}return t.prototype.create=function(t,r,n,i){var a="string"==typeof t?e.__assign(e.__assign({},i||{}),{entityName:t,entityOp:r,data:n}):t;return this.createCore(a)},t.prototype.createCore=function(t){var e=t.entityName,r=t.entityOp,n=t.tag;if(!e)throw new Error("Missing entity name for new action");if(null==r)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(r,n||e),payload:t}},t.prototype.createFromAction=function(t,r){return this.create(e.__assign(e.__assign({},t.payload),r))},t.prototype.formatActionType=function(t,e){return"["+e+"] "+t},e.__decorate([r.Injectable()],t)}(),h=function(){function t(t,e){this.entityName=t,this.selectId=e}return t.prototype.mustBeEntity=function(t){var e=this.extractData(t);if(!e)return this.throwError(t,"should have a single entity.");var r=this.selectId(e);return this.isNotKeyType(r)&&this.throwError(t,"has a missing or invalid entity key (id)"),e},t.prototype.mustBeEntities=function(t){var e=this,r=this.extractData(t);return Array.isArray(r)?(r.forEach((function(r,n){var i=e.selectId(r);e.isNotKeyType(i)&&e.throwError(t,", item "+(n+1)+", does not have a valid entity key (id)")})),r):this.throwError(t,"should be an array of entities")},t.prototype.mustBeKey=function(t){var e=this.extractData(t);if(!e)throw new Error("should be a single entity key");if(this.isNotKeyType(e))throw new Error("is not a valid key (id)");return e},t.prototype.mustBeKeys=function(t){var e=this,r=this.extractData(t);return Array.isArray(r)?(r.forEach((function(r,n){e.isNotKeyType(r)&&e.throwError(t,e.entityName+" ', item "+(n+1)+", is not a valid entity key (id)")})),r):this.throwError(t,"should be an array of entity keys (id)")},t.prototype.mustBeUpdate=function(t){var e=this.extractData(t);if(!e)return this.throwError(t,"should be a single entity update");var r=e.id,n=this.selectId(e.changes);return(this.isNotKeyType(r)||this.isNotKeyType(n))&&this.throwError(t,"has a missing or invalid entity key (id)"),e},t.prototype.mustBeUpdates=function(t){var e=this,r=this.extractData(t);return Array.isArray(r)?(r.forEach((function(r,n){var i=r.id,a=e.selectId(r.changes);(e.isNotKeyType(i)||e.isNotKeyType(a))&&e.throwError(t,", item "+(n+1)+", has a missing or invalid entity key (id)")})),r):this.throwError(t,"should be an array of entity updates")},t.prototype.mustBeUpdateResponse=function(t){var e=this.extractData(t);if(!e)return this.throwError(t,"should be a single entity update");var r=e.id,n=this.selectId(e.changes);return(this.isNotKeyType(r)||this.isNotKeyType(n))&&this.throwError(t,"has a missing or invalid entity key (id)"),e},t.prototype.mustBeUpdateResponses=function(t){var e=this,r=this.extractData(t);return Array.isArray(r)?(r.forEach((function(r,n){var i=r.id,a=e.selectId(r.changes);(e.isNotKeyType(i)||e.isNotKeyType(a))&&e.throwError(t,", item "+(n+1)+", has a missing or invalid entity key (id)")})),r):this.throwError(t,"should be an array of entity updates")},t.prototype.extractData=function(t){return t.payload&&t.payload.data},t.prototype.isNotKeyType=function(t){return"string"!=typeof t&&"number"!=typeof t},t.prototype.throwError=function(t,e){throw new Error(this.entityName+' EntityAction guard for "'+t.type+'": payload '+e)},t}();function y(t){return null==t?void 0:t.id}function d(t){if(null==t)return[];if(Array.isArray(t[0])){var r=e.__read(t),n=r[0],i=r.slice(1);t=e.__spread(n,i)}return t}function l(t){return t=t||y,function e(r){var n=t(r);if(null==n)throw new Error("Primary key may not be null/undefined.");return r&&{id:n,changes:r}}}function E(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=d(t);switch(r.length){case 0:return n.filter((function(t){return t.payload&&null!=t.payload.entityOp}));case 1:var i=r[0];return n.filter((function(t){return t.payload&&i===t.payload.entityOp}));default:return n.filter((function(t){var e=t.payload&&t.payload.entityOp;return e&&r.some((function(t){return t===e}))}))}}function g(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=d(t);switch(r.length){case 0:return n.filter((function(t){return t.payload&&null!=t.payload.entityName}));case 1:var i=r[0];return n.filter((function(t){return t.payload&&i===t.payload.entityName}));default:return n.filter((function(t){var e=t.payload&&t.payload.entityName;return!!e&&r.some((function(t){return t===e}))}))}}(p=t.ChangeSetOperation||(t.ChangeSetOperation={})).Add="Add",p.Delete="Delete",p.Update="Update",p.Upsert="Upsert";var _,f,S=function(){function e(){}return e.prototype.add=function(e,r){return r=Array.isArray(r)?r:r?[r]:[],{entityName:e,op:t.ChangeSetOperation.Add,entities:r}},e.prototype.delete=function(e,r){var n=Array.isArray(r)?r:r?[r]:[];return{entityName:e,op:t.ChangeSetOperation.Delete,entities:n}},e.prototype.update=function(e,r){return r=Array.isArray(r)?r:r?[r]:[],{entityName:e,op:t.ChangeSetOperation.Update,entities:r}},e.prototype.upsert=function(e,r){return r=Array.isArray(r)?r:r?[r]:[],{entityName:e,op:t.ChangeSetOperation.Upsert,entities:r}},e}(),v=new S;function m(t){var r=(t=t&&t.changes?t:{changes:[]}).changes.filter((function(t){return null!=t&&t.entities&&t.entities.length>0}));return e.__assign(e.__assign({},t),{changes:r})}(_=t.MergeStrategy||(t.MergeStrategy={}))[_.IgnoreChanges=0]="IgnoreChanges",_[_.PreserveChanges=1]="PreserveChanges",_[_.OverwriteChanges=2]="OverwriteChanges",(f=t.EntityCacheAction||(t.EntityCacheAction={})).CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",f.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",f.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",f.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",f.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",f.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",f.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",f.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",f.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success";var O,A=function A(e,r){this.type=t.EntityCacheAction.CLEAR_COLLECTIONS,this.payload={collections:e,tag:r}},C=function C(e,r){this.type=t.EntityCacheAction.LOAD_COLLECTIONS,this.payload={collections:e,tag:r}},T=function T(e,r,n){this.type=t.EntityCacheAction.MERGE_QUERY_SET,this.payload={querySet:e,mergeStrategy:null===r?t.MergeStrategy.PreserveChanges:r,tag:n}},D=function D(e,r){this.cache=e,this.type=t.EntityCacheAction.SET_ENTITY_CACHE,this.payload={cache:e,tag:r}},R=function R(r,n,i){this.type=t.EntityCacheAction.SAVE_ENTITIES,i=i||{},r&&(r.tag=r.tag||i.tag),this.payload=e.__assign(e.__assign({changeSet:r,url:n},i),{tag:r.tag})},M=function M(e,r,n,i){this.type=t.EntityCacheAction.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:r,entityNames:n,tag:i}},N=function N(e,r,n){this.type=t.EntityCacheAction.SAVE_ENTITIES_CANCEL,this.payload={correlationId:e,reason:r,tag:n}},U=function U(e,r){this.type=t.EntityCacheAction.SAVE_ENTITIES_ERROR,this.payload={error:e,originalAction:r,correlationId:r.payload.correlationId}},I=function I(r,n,i){this.type=t.EntityCacheAction.SAVE_ENTITIES_SUCCESS,i=i||{},r&&(r.tag=r.tag||i.tag),this.payload=e.__assign(e.__assign({changeSet:r,url:n},i),{tag:r.tag})};function x(t){return t+"/error"}function L(t){return t+"/success"}(O=t.EntityOp||(t.EntityOp={})).CANCEL_PERSIST="@ngrx/data/cancel-persist",O.CANCELED_PERSIST="@ngrx/data/canceled-persist",O.QUERY_ALL="@ngrx/data/query-all",O.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",O.QUERY_ALL_ERROR="@ngrx/data/query-all/error",O.QUERY_LOAD="@ngrx/data/query-load",O.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",O.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",O.QUERY_MANY="@ngrx/data/query-many",O.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",O.QUERY_MANY_ERROR="@ngrx/data/query-many/error",O.QUERY_BY_KEY="@ngrx/data/query-by-key",O.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",O.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",O.SAVE_ADD_MANY="@ngrx/data/save/add-many",O.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",O.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",O.SAVE_ADD_ONE="@ngrx/data/save/add-one",O.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",O.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",O.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",O.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",O.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",O.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",O.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",O.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",O.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",O.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",O.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",O.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",O.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",O.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",O.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",O.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",O.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",O.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",O.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",O.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",O.ADD_ALL="@ngrx/data/add-all",O.ADD_MANY="@ngrx/data/add-many",O.ADD_ONE="@ngrx/data/add-one",O.REMOVE_ALL="@ngrx/data/remove-all",O.REMOVE_MANY="@ngrx/data/remove-many",O.REMOVE_ONE="@ngrx/data/remove-one",O.UPDATE_MANY="@ngrx/data/update-many",O.UPDATE_ONE="@ngrx/data/update-one",O.UPSERT_MANY="@ngrx/data/upsert-many",O.UPSERT_ONE="@ngrx/data/upsert-one",O.COMMIT_ALL="@ngrx/data/commit-all",O.COMMIT_MANY="@ngrx/data/commit-many",O.COMMIT_ONE="@ngrx/data/commit-one",O.UNDO_ALL="@ngrx/data/undo-all",O.UNDO_MANY="@ngrx/data/undo-many",O.UNDO_ONE="@ngrx/data/undo-one",O.SET_CHANGE_STATE="@ngrx/data/set-change-state",O.SET_COLLECTION="@ngrx/data/set-collection",O.SET_FILTER="@ngrx/data/set-filter",O.SET_LOADED="@ngrx/data/set-loaded",O.SET_LOADING="@ngrx/data/set-loading";var b=function b(t,e){this.error=t,this.requestData=e,this.message="string"==typeof t?t:function r(t){var e=t.error,r=t.body,n=t.message,i=null;return e?i="string"==typeof e?e:e.message:n?i=n:r&&(i="string"==typeof r?r:r.error),"string"==typeof i?i:i?JSON.stringify(i):null}(t)},k=function k(){},w=function w(){},Y=new r.InjectionToken("@ngrx/data/plural-names"),V=function V(){},F=function F(){},$=function $(){},P=function(){function t(t){this.pluralizer=t,this.knownHttpResourceUrls={}}return t.prototype.getResourceUrls=function(t,e){var r,n=this.knownHttpResourceUrls[t];if(!n){var i=j(e);n={entityResourceUrl:(i+"/"+t+"/").toLowerCase(),collectionResourceUrl:(i+"/"+this.pluralizer.pluralize(t)+"/").toLowerCase()},this.registerHttpResourceUrls(((r={})[t]=n,r))}return n},t.prototype.entityResource=function(t,e){return this.getResourceUrls(t,e).entityResourceUrl},t.prototype.collectionResource=function(t,e){return this.getResourceUrls(t,e).collectionResourceUrl},t.prototype.registerHttpResourceUrls=function(t){this.knownHttpResourceUrls=e.__assign(e.__assign({},this.knownHttpResourceUrls),t||{})},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[V])],t)}();function j(t){return t.replace(/^[\/\s]+|[\/\s]+$/g,"")}var B=function(){function t(t,e,r,n){this.http=e,this.httpUrlGenerator=r,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=t+" DefaultDataService",this.entityName=t;var i=n||{},a=i.root,s=void 0===a?"api":a,o=i.delete404OK,c=i.getDelay,p=void 0===c?0:c,u=i.saveDelay,h=void 0===u?0:u,y=i.timeout,d=void 0===y?0:y;this.delete404OK=void 0===o||o,this.entityUrl=r.entityResource(t,s),this.entitiesUrl=r.collectionResource(t,s),this.getDelay=p,this.saveDelay=h,this.timeout=d}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e=t||new Error('No "'+this.entityName+'" entity to add');return this.execute("POST",this.entityUrl,e)},t.prototype.delete=function(t){var e;return null==t&&(e=new Error('No "'+this.entityName+'" key to delete')),this.execute("DELETE",this.entityUrl+t,e).pipe(n.map((function(e){return t})))},t.prototype.getAll=function(){return this.execute("GET",this.entitiesUrl)},t.prototype.getById=function(t){var e;return null==t&&(e=new Error('No "'+this.entityName+'" key to get')),this.execute("GET",this.entityUrl+t,e)},t.prototype.getWithQuery=function(t){var e=new i.HttpParams("string"==typeof t?{fromString:t}:{fromObject:t});return this.execute("GET",this.entitiesUrl,void 0,{params:e})},t.prototype.update=function(t){var e=t&&t.id,r=null==e?new Error('No "'+this.entityName+'" update data or id'):t.changes;return this.execute("PUT",this.entityUrl+e,r)},t.prototype.upsert=function(t){var e=t||new Error('No "'+this.entityName+'" entity to upsert');return this.execute("POST",this.entityUrl,e)},t.prototype.execute=function(t,e,r,i){var s,o={method:t,url:e,data:r,options:i};if(r instanceof Error)return this.handleError(o)(r);switch(t){case"DELETE":s=this.http.delete(e,i),this.saveDelay&&(s=s.pipe(n.delay(this.saveDelay)));break;case"GET":s=this.http.get(e,i),this.getDelay&&(s=s.pipe(n.delay(this.getDelay)));break;case"POST":s=this.http.post(e,r,i),this.saveDelay&&(s=s.pipe(n.delay(this.saveDelay)));break;case"PUT":s=this.http.put(e,r,i),this.saveDelay&&(s=s.pipe(n.delay(this.saveDelay)));break;default:var c=new Error("Unimplemented HTTP method, "+t);s=a.throwError(c)}return this.timeout&&(s=s.pipe(n.timeout(this.timeout+this.saveDelay))),s.pipe(n.catchError(this.handleError(o)))},t.prototype.handleError=function(t){var e=this;return function(r){var n=e.handleDelete404(r,t);if(n)return n;var i=new b(r,t);return a.throwError(i)}},t.prototype.handleDelete404=function(t,e){if(404===t.status&&"DELETE"===e.method&&this.delete404OK)return a.of({})},t}(),Q=function(){function t(t,e,r){this.http=t,this.httpUrlGenerator=e,this.config=r,e.registerHttpResourceUrls((r=r||{}).entityHttpResourceUrls)}return t.prototype.create=function(t){return new B(t,this.http,this.httpUrlGenerator,this.config)},e.__decorate([r.Injectable(),e.__param(2,r.Optional()),e.__metadata("design:paramtypes",[i.HttpClient,$,k])],t)}();function q(t){var r=t.entityName;if(!r)throw new Error("Missing required entityName");t.entityName=r=r.trim();var n=t.selectId||y,i=t.sortComparer=t.sortComparer||!1,a=s.createEntityAdapter({selectId:n,sortComparer:i}),o=t.entityDispatcherOptions||{},c=a.getInitialState(e.__assign({entityName:r,filter:"",loaded:!1,loading:!1,changeState:{}},t.additionalCollectionState||{}));return{entityName:r,entityAdapter:a,entityDispatcherOptions:o,initialState:c,metadata:t,noChangeTracking:!0===t.noChangeTracking,selectId:n,sortComparer:i}}var K=new r.InjectionToken("@ngrx/data/entity-metadata"),H=function(){function t(t){var e=this;this.definitions={},t&&t.forEach((function(t){return e.registerMetadataMap(t)}))}return t.prototype.getDefinition=function(t,e){void 0===e&&(e=!0),t=t.trim();var r=this.definitions[t];if(!r&&e)throw new Error('No EntityDefinition for entity type "'+t+'".');return r},t.prototype.registerMetadata=function(t){if(t){var e=q(t);this.registerDefinition(e)}},t.prototype.registerMetadataMap=function(t){var r=this;void 0===t&&(t={}),Object.keys(t||{}).forEach((function(n){return r.registerMetadata(e.__assign({entityName:n},t[n]))}))},t.prototype.registerDefinition=function(t){this.definitions[t.entityName]=t},t.prototype.registerDefinitions=function(t){Object.assign(this.definitions,t)},e.__decorate([r.Injectable(),e.__param(0,r.Optional()),e.__param(0,r.Inject(K)),e.__metadata("design:paramtypes",[Array])],t)}(),G=t.ChangeSetOperation.Update,W=function(){function t(t,e,r){this.entityDefinitionService=t,this.http=e,this.idSelectors={},this.saveDelay=0,this.timeout=0;var n=r||{},i=n.saveDelay,a=n.timeout,s=void 0===a?0:a;this.saveDelay=void 0===i?0:i,this.timeout=s}return t.prototype.saveEntities=function(t,e){var r=this;t=this.filterChangeSet(t),t=this.flattenUpdates(t);var i=this.http.post(e,t).pipe(n.map((function(t){return r.restoreUpdates(t)})),n.catchError(this.handleError({method:"POST",url:e,data:t})));return this.timeout&&(i=i.pipe(n.timeout(this.timeout))),this.saveDelay&&(i=i.pipe(n.delay(this.saveDelay))),i},t.prototype.handleError=function(t){return function(e){var r=new b(e,t);return a.throwError(r)}},t.prototype.filterChangeSet=function(t){return m(t)},t.prototype.flattenUpdates=function(t){var r=t.changes;if(0===r.length)return t;var n=!1;return r=r.map((function(t){return t.op===G&&t.entities.length>0?(n=!0,e.__assign(e.__assign({},t),{entities:t.entities.map((function(t){return t.changes}))})):t})),n?e.__assign(e.__assign({},t),{changes:r}):t},t.prototype.restoreUpdates=function(t){var r=this;if(null==t)return t;var n=t.changes;if(0===n.length)return t;var i=!1;return n=n.map((function(t){if(t.op===G){i=!0;var n=r.getIdSelector(t.entityName);return e.__assign(e.__assign({},t),{entities:t.entities.map((function(t){return{id:n(t),changes:t}}))})}return t})),i?e.__assign(e.__assign({},t),{changes:n}):t},t.prototype.getIdSelector=function(t){var e=this.idSelectors[t];return e||(e=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=e),e},e.__decorate([r.Injectable(),e.__param(2,r.Optional()),e.__metadata("design:paramtypes",[H,i.HttpClient,k])],t)}(),z=function(){function t(t){this.defaultDataServiceFactory=t,this.services={}}return t.prototype.getService=function(t){t=t.trim();var e=this.services[t];return e||(e=this.defaultDataServiceFactory.create(t),this.services[t]=e),e},t.prototype.registerService=function(t,e){this.services[t.trim()]=e},t.prototype.registerServices=function(t){this.services=e.__assign(e.__assign({},this.services),t)},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[Q])],t)}(),J=function J(){},X=function(){function t(t,e){this.logger=t,this.entityActionFactory=e}return t.prototype.handleSuccess=function(t){var e=this,r=L(t.payload.entityOp);return function(n){return e.entityActionFactory.createFromAction(t,{entityOp:r,data:n})}},t.prototype.handleError=function(t){var e=this,r=x(t.payload.entityOp);return function(n){var i={error:n instanceof b?n:new b(n,null),originalAction:t};return e.logger.error(i),e.entityActionFactory.createFromAction(t,{entityOp:r,data:i})}},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[w,u])],t)}(),Z=function(){function t(){this.seed=0,this.prefix="CRID"}return t.prototype.next=function(){return this.seed+=1,this.prefix+this.seed},e.__decorate([r.Injectable()],t)}(),tt=e.__decorate([r.Injectable()],(function tt(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1})),et=function et(t){this.message=t,this.message=t||"Canceled by user"},rt=function(){function i(t,e,r,i){this.correlationIdGenerator=t,this.defaultDispatcherOptions=e,this.store=i,this.reducedActions$=r.pipe(n.shareReplay(1)),this.raSubscription=this.reducedActions$.subscribe()}return i.prototype.dispatch=function(t){return this.store.dispatch(t),t},i.prototype.cancelSaveEntities=function(t,e,r,n){if(!t)throw new Error("Missing correlationId");var i=new M(t,e,r,n);this.dispatch(i)},i.prototype.clearCollections=function(t,e){this.dispatch(new A(t,e))},i.prototype.loadCollections=function(t,e){this.dispatch(new C(t,e))},i.prototype.mergeQuerySet=function(t,e,r){this.dispatch(new T(t,e,r))},i.prototype.setEntityCache=function(t,e){this.dispatch(new D(t,e))},i.prototype.saveEntities=function(t,r,i){var a=Array.isArray(t)?{changes:t}:t,s=null==(i=i||{}).correlationId?this.correlationIdGenerator.next():i.correlationId,o=null==i.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===i.isOptimistic,c=i.tag||"Save Entities";i=e.__assign(e.__assign({},i),{correlationId:s,isOptimistic:o,tag:c});var p=new R(a,r,i);return this.dispatch(p),this.getSaveEntitiesResponseData$(i.correlationId).pipe(n.shareReplay(1))},i.prototype.getSaveEntitiesResponseData$=function(e){return this.reducedActions$.pipe(n.filter((function(e){return e.type===t.EntityCacheAction.SAVE_ENTITIES_SUCCESS||e.type===t.EntityCacheAction.SAVE_ENTITIES_ERROR||e.type===t.EntityCacheAction.SAVE_ENTITIES_CANCEL})),n.filter((function(t){return e===t.payload.correlationId})),n.take(1),n.mergeMap((function(e){return e.type===t.EntityCacheAction.SAVE_ENTITIES_CANCEL?a.throwError(new et(e.payload.reason)):e.type===t.EntityCacheAction.SAVE_ENTITIES_SUCCESS?a.of(e.payload.changeSet):a.throwError(e.payload)})))},e.__decorate([r.Injectable(),e.__param(2,r.Inject(o.ScannedActionsSubject)),e.__metadata("design:paramtypes",[Z,tt,a.Observable,o.Store])],i)}(),nt=function(){function r(t,e,r,n,i,a,s,c){void 0===n&&(n=y),this.entityName=t,this.entityActionFactory=e,this.store=r,this.selectId=n,this.defaultDispatcherOptions=i,this.reducedActions$=a,this.correlationIdGenerator=c,this.guard=new h(t,n),this.toUpdate=l(n);var p=o.createSelector(s,(function(e){return e[t]}));this.entityCollection$=r.select(p)}return r.prototype.createEntityAction=function(t,r,n){return this.entityActionFactory.create(e.__assign({entityName:this.entityName,entityOp:t,data:r},n))},r.prototype.createAndDispatch=function(t,e,r){var n=this.createEntityAction(t,e,r);return this.dispatch(n),n},r.prototype.dispatch=function(t){return this.store.dispatch(t),t},r.prototype.add=function(r,i){var a=this;i=this.setSaveEntityActionOptions(i,this.defaultDispatcherOptions.optimisticAdd);var s=this.createEntityAction(t.EntityOp.SAVE_ADD_ONE,r,i);return i.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(i.correlationId).pipe(n.withLatestFrom(this.entityCollection$),n.map((function(t){var r=e.__read(t,2);return r[1].entities[a.selectId(r[0])]})),n.shareReplay(1))},r.prototype.cancel=function(e,r,n){if(!e)throw new Error("Missing correlationId");this.createAndDispatch(t.EntityOp.CANCEL_PERSIST,r,{correlationId:e})},r.prototype.delete=function(e,r){r=this.setSaveEntityActionOptions(r,this.defaultDispatcherOptions.optimisticDelete);var i=this.getKey(e),a=this.createEntityAction(t.EntityOp.SAVE_DELETE_ONE,i,r);return this.guard.mustBeKey(a),this.dispatch(a),this.getResponseData$(r.correlationId).pipe(n.map((function(){return i})),n.shareReplay(1))},r.prototype.getAll=function(r){var i=this;r=this.setQueryEntityActionOptions(r);var a=this.createEntityAction(t.EntityOp.QUERY_ALL,null,r);return this.dispatch(a),this.getResponseData$(r.correlationId).pipe(n.withLatestFrom(this.entityCollection$),n.map((function(t){var r=e.__read(t,2),n=r[1];return r[0].reduce((function(t,e){var r=n.entities[i.selectId(e)];return r&&t.push(r),t}),[])})),n.shareReplay(1))},r.prototype.getByKey=function(r,i){var a=this;i=this.setQueryEntityActionOptions(i);var s=this.createEntityAction(t.EntityOp.QUERY_BY_KEY,r,i);return this.dispatch(s),this.getResponseData$(i.correlationId).pipe(n.withLatestFrom(this.entityCollection$),n.map((function(t){var r=e.__read(t,2);return r[1].entities[a.selectId(r[0])]})),n.shareReplay(1))},r.prototype.getWithQuery=function(r,i){var a=this;i=this.setQueryEntityActionOptions(i);var s=this.createEntityAction(t.EntityOp.QUERY_MANY,r,i);return this.dispatch(s),this.getResponseData$(i.correlationId).pipe(n.withLatestFrom(this.entityCollection$),n.map((function(t){var r=e.__read(t,2),n=r[1];return r[0].reduce((function(t,e){var r=n.entities[a.selectId(e)];return r&&t.push(r),t}),[])})),n.shareReplay(1))},r.prototype.load=function(e){e=this.setQueryEntityActionOptions(e);var r=this.createEntityAction(t.EntityOp.QUERY_LOAD,null,e);return this.dispatch(r),this.getResponseData$(e.correlationId).pipe(n.shareReplay(1))},r.prototype.update=function(r,i){var a=this,s=this.toUpdate(r);i=this.setSaveEntityActionOptions(i,this.defaultDispatcherOptions.optimisticUpdate);var o=this.createEntityAction(t.EntityOp.SAVE_UPDATE_ONE,s,i);return i.isOptimistic&&this.guard.mustBeUpdate(o),this.dispatch(o),this.getResponseData$(i.correlationId).pipe(n.map((function(t){return t.changes})),n.withLatestFrom(this.entityCollection$),n.map((function(t){var r=e.__read(t,2);return r[1].entities[a.selectId(r[0])]})),n.shareReplay(1))},r.prototype.upsert=function(r,i){var a=this;i=this.setSaveEntityActionOptions(i,this.defaultDispatcherOptions.optimisticUpsert);var s=this.createEntityAction(t.EntityOp.SAVE_UPSERT_ONE,r,i);return i.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(i.correlationId).pipe(n.withLatestFrom(this.entityCollection$),n.map((function(t){var r=e.__read(t,2);return r[1].entities[a.selectId(r[0])]})),n.shareReplay(1))},r.prototype.addAllToCache=function(e,r){this.createAndDispatch(t.EntityOp.ADD_ALL,e,r)},r.prototype.addOneToCache=function(e,r){this.createAndDispatch(t.EntityOp.ADD_ONE,e,r)},r.prototype.addManyToCache=function(e,r){this.createAndDispatch(t.EntityOp.ADD_MANY,e,r)},r.prototype.clearCache=function(e){this.createAndDispatch(t.EntityOp.REMOVE_ALL,void 0,e)},r.prototype.removeOneFromCache=function(e,r){this.createAndDispatch(t.EntityOp.REMOVE_ONE,this.getKey(e),r)},r.prototype.removeManyFromCache=function(e,r){var n=this;if(e&&0!==e.length){var i="object"==typeof e[0]?e.map((function(t){return n.getKey(t)})):e;this.createAndDispatch(t.EntityOp.REMOVE_MANY,i,r)}},r.prototype.updateOneInCache=function(e,r){var n=this.toUpdate(e);this.createAndDispatch(t.EntityOp.UPDATE_ONE,n,r)},r.prototype.updateManyInCache=function(e,r){var n=this;if(e&&0!==e.length){var i=e.map((function(t){return n.toUpdate(t)}));this.createAndDispatch(t.EntityOp.UPDATE_MANY,i,r)}},r.prototype.upsertOneInCache=function(e,r){this.createAndDispatch(t.EntityOp.UPSERT_ONE,e,r)},r.prototype.upsertManyInCache=function(e,r){e&&0!==e.length&&this.createAndDispatch(t.EntityOp.UPSERT_MANY,e,r)},r.prototype.setFilter=function(e){this.createAndDispatch(t.EntityOp.SET_FILTER,e)},r.prototype.setLoaded=function(e){this.createAndDispatch(t.EntityOp.SET_LOADED,!!e)},r.prototype.setLoading=function(e){this.createAndDispatch(t.EntityOp.SET_LOADING,!!e)},r.prototype.getKey=function(t){return"object"==typeof t?this.selectId(t):t},r.prototype.getResponseData$=function(e){var r=this;return this.reducedActions$.pipe(n.filter((function(t){return!!t.payload})),n.filter((function(n){var i=n.payload,a=i.entityOp;return i.entityName===r.entityName&&i.correlationId===e&&(a.endsWith("/success")||a.endsWith("/error")||a===t.EntityOp.CANCEL_PERSIST)})),n.take(1),n.mergeMap((function(e){var r=e.payload.entityOp;return r===t.EntityOp.CANCEL_PERSIST?a.throwError(new et(e.payload.data)):r.endsWith("/success")?a.of(e.payload.data):a.throwError(e.payload.data.error)})))},r.prototype.setQueryEntityActionOptions=function(t){var r=null==(t=t||{}).correlationId?this.correlationIdGenerator.next():t.correlationId;return e.__assign(e.__assign({},t),{correlationId:r})},r.prototype.setSaveEntityActionOptions=function(t,r){var n=null==(t=t||{}).correlationId?this.correlationIdGenerator.next():t.correlationId,i=null==t.isOptimistic?r||!1:!0===t.isOptimistic;return e.__assign(e.__assign({},t),{correlationId:n,isOptimistic:i})},r}(),it=new r.InjectionToken("@ngrx/data/entity-cache-name"),at=new r.InjectionToken("@ngrx/data/entity-cache-meta-reducers"),st=new r.InjectionToken("@ngrx/data/entity-collection-meta-reducers"),ot=new r.InjectionToken("@ngrx/data/initial-entity-cache-state"),ct=new r.InjectionToken("@ngrx/data/entity-cache-selector"),pt={provide:ct,useFactory:ut,deps:[[new r.Optional,it]]};function ut(t){return o.createFeatureSelector(t=t||"entityCache")}var ht=function(){function t(t,e,r,i,a,s){this.entityActionFactory=t,this.store=e,this.entityDispatcherDefaultOptions=r,this.entityCacheSelector=a,this.correlationIdGenerator=s,this.reducedActions$=i.pipe(n.shareReplay(1)),this.raSubscription=this.reducedActions$.subscribe()}return t.prototype.create=function(t,r,n){void 0===r&&(r=y),void 0===n&&(n={});var i=e.__assign(e.__assign({},this.entityDispatcherDefaultOptions),n);return new nt(t,this.entityActionFactory,this.store,r,i,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)},t.prototype.ngOnDestroy=function(){this.raSubscription.unsubscribe()},e.__decorate([r.Injectable(),e.__param(3,r.Inject(o.ScannedActionsSubject)),e.__param(4,r.Inject(ct)),e.__metadata("design:paramtypes",[u,o.Store,tt,a.Observable,Function,Z])],t)}(),yt=new r.InjectionToken("EntityEffects Scheduler"),dt=function(){function i(e,r,i,a,s){var o=this;this.actions=e,this.dataService=r,this.entityActionFactory=i,this.logger=a,this.scheduler=s,this.responseDelay=10,this.saveEntitiesCancel$=c.createEffect((function(){return o.actions.pipe(c.ofType(t.EntityCacheAction.SAVE_ENTITIES_CANCEL),n.filter((function(t){return null!=t.payload.correlationId})))}),{dispatch:!1}),this.saveEntities$=c.createEffect((function(){return o.actions.pipe(c.ofType(t.EntityCacheAction.SAVE_ENTITIES),n.mergeMap((function(t){return o.saveEntities(t)})))}))}return i.prototype.saveEntities=function(t){var e=this,r=t.payload.error;if(r)return this.handleSaveEntitiesError$(t)(r);try{var i=m(t.payload.changeSet),s=t.payload,o=s.correlationId,c=s.url;if(0===i.changes.length)return a.of(new I(i,c,{correlationId:o,mergeStrategy:s.mergeStrategy,tag:s.tag}));var p=this.saveEntitiesCancel$.pipe(n.filter((function(t){return o===t.payload.correlationId})),n.map((function(t){return new N(o,t.payload.reason,t.payload.tag)}))),u=this.dataService.saveEntities(i,c).pipe(n.concatMap((function(r){return e.handleSaveEntitiesSuccess$(t,e.entityActionFactory)(r)})),n.catchError(this.handleSaveEntitiesError$(t)));return a.race(p,u)}catch(e){return this.handleSaveEntitiesError$(t)(e)}},i.prototype.handleSaveEntitiesError$=function(t){var e=this;return function(r){var i=r instanceof b?r:new b(r,null);return a.of(new U(i,t)).pipe(n.delay(e.responseDelay,e.scheduler||a.asyncScheduler))}},i.prototype.handleSaveEntitiesSuccess$=function(e,r){var n=e.payload,i=n.url,s={correlationId:n.correlationId,mergeStrategy:n.mergeStrategy,tag:n.tag};return function(n){if(n)return a.of(new I(n,i,s));if(n=e.payload.changeSet,!e.payload.isOptimistic)return a.of(new I(n,i,s));var o=n.changes.reduce((function(t,e){return-1===t.indexOf(e.entityName)?t.concat(e.entityName):t}),[]);return a.merge(o.map((function(e){return r.create(e,t.EntityOp.SET_LOADING,!1)})))}},e.__decorate([r.Injectable(),e.__param(4,r.Optional()),e.__param(4,r.Inject(yt)),e.__metadata("design:paramtypes",[c.Actions,W,u,w,Object])],i)}(),lt=[t.EntityOp.QUERY_ALL,t.EntityOp.QUERY_LOAD,t.EntityOp.QUERY_BY_KEY,t.EntityOp.QUERY_MANY,t.EntityOp.SAVE_ADD_ONE,t.EntityOp.SAVE_DELETE_ONE,t.EntityOp.SAVE_UPDATE_ONE,t.EntityOp.SAVE_UPSERT_ONE],Et=function(){function i(e,r,i,a,s){var o=this;this.actions=e,this.dataService=r,this.entityActionFactory=i,this.resultHandler=a,this.scheduler=s,this.responseDelay=10,this.cancel$=c.createEffect((function(){return o.actions.pipe(E(t.EntityOp.CANCEL_PERSIST),n.map((function(t){return t.payload.correlationId})),n.filter((function(t){return null!=t})))}),{dispatch:!1}),this.persist$=c.createEffect((function(){return o.actions.pipe(E(lt),n.mergeMap((function(t){return o.persist(t)})))}))}return i.prototype.persist=function(e){var r=this;if(e.payload.skip)return this.handleSkipSuccess$(e);if(e.payload.error)return this.handleError$(e)(e.payload.error);try{var i=this.cancel$.pipe(n.filter((function(t){return e.payload.correlationId===t})),n.map((function(n){return r.entityActionFactory.createFromAction(e,{entityOp:t.EntityOp.CANCELED_PERSIST})}))),s=this.callDataService(e).pipe(n.map(this.resultHandler.handleSuccess(e)),n.catchError(this.handleError$(e)));return a.race(i,s)}catch(t){return this.handleError$(e)(t)}},i.prototype.callDataService=function(r){var i=r.payload,a=i.entityOp,s=i.data,o=this.dataService.getService(i.entityName);switch(a){case t.EntityOp.QUERY_ALL:case t.EntityOp.QUERY_LOAD:return o.getAll();case t.EntityOp.QUERY_BY_KEY:return o.getById(s);case t.EntityOp.QUERY_MANY:return o.getWithQuery(s);case t.EntityOp.SAVE_ADD_ONE:return o.add(s);case t.EntityOp.SAVE_DELETE_ONE:return o.delete(s);case t.EntityOp.SAVE_UPDATE_ONE:var c=s.id,p=s.changes;return o.update(s).pipe(n.map((function(t){return t&&Object.keys(t).length>0?{id:c,changes:e.__assign(e.__assign({},p),t),changed:!0}:{id:c,changes:p,changed:!1}})));case t.EntityOp.SAVE_UPSERT_ONE:return o.upsert(s).pipe(n.map((function(t){return t&&Object.keys(t).length>0?t:s})));default:throw new Error('Persistence action "'+a+'" is not implemented.')}},i.prototype.handleError$=function(t){var e=this;return function(r){return a.of(e.resultHandler.handleError(t)(r)).pipe(n.delay(e.responseDelay,e.scheduler||a.asyncScheduler))}},i.prototype.handleSkipSuccess$=function(t){var e=L(t.payload.entityOp),r=this.entityActionFactory.createFromAction(t,{entityOp:e});return a.of(r).pipe(n.delay(this.responseDelay,this.scheduler||a.asyncScheduler))},e.__decorate([r.Injectable(),e.__param(4,r.Optional()),e.__param(4,r.Inject(yt)),e.__metadata("design:paramtypes",[c.Actions,z,u,J,Object])],i)}(),gt=function(){function t(t,e){this.entityName=t,t=t.trim();var r=e.create(t),n=r.dispatcher,i=r.selectors,a=r.selectors$;this.entityName=t,this.dispatcher=n,this.guard=n.guard,this.selectId=n.selectId,this.toUpdate=n.toUpdate,this.selectors=i,this.selectors$=a,this.collection$=a.collection$,this.count$=a.count$,this.entities$=a.entities$,this.entityActions$=a.entityActions$,this.entityMap$=a.entityMap$,this.errors$=a.errors$,this.filter$=a.filter$,this.filteredEntities$=a.filteredEntities$,this.keys$=a.keys$,this.loaded$=a.loaded$,this.loading$=a.loading$,this.changeState$=a.changeState$}return t.prototype.createEntityAction=function(t,e,r){return this.dispatcher.createEntityAction(t,e,r)},t.prototype.createAndDispatch=function(t,e,r){return this.dispatcher.createAndDispatch(t,e,r)},t.prototype.dispatch=function(t){return this.dispatcher.dispatch(t)},Object.defineProperty(t.prototype,"store",{get:function(){return this.dispatcher.store},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){return this.dispatcher.add(t,e)},t.prototype.cancel=function(t,e,r){this.dispatcher.cancel(t,e,r)},t.prototype.delete=function(t,e){return this.dispatcher.delete(t,e)},t.prototype.getAll=function(t){return this.dispatcher.getAll(t)},t.prototype.getByKey=function(t,e){return this.dispatcher.getByKey(t,e)},t.prototype.getWithQuery=function(t,e){return this.dispatcher.getWithQuery(t,e)},t.prototype.load=function(t){return this.dispatcher.load(t)},t.prototype.update=function(t,e){return this.dispatcher.update(t,e)},t.prototype.upsert=function(t,e){return this.dispatcher.upsert(t,e)},t.prototype.addAllToCache=function(t,e){this.dispatcher.addAllToCache(t,e)},t.prototype.addOneToCache=function(t,e){this.dispatcher.addOneToCache(t,e)},t.prototype.addManyToCache=function(t,e){this.dispatcher.addManyToCache(t,e)},t.prototype.clearCache=function(){this.dispatcher.clearCache()},t.prototype.removeOneFromCache=function(t,e){this.dispatcher.removeOneFromCache(t,e)},t.prototype.removeManyFromCache=function(t,e){this.dispatcher.removeManyFromCache(t,e)},t.prototype.updateOneInCache=function(t,e){this.dispatcher.updateOneInCache(t,e)},t.prototype.updateManyInCache=function(t,e){this.dispatcher.updateManyInCache(t,e)},t.prototype.upsertOneInCache=function(t,e){this.dispatcher.upsertOneInCache(t,e)},t.prototype.upsertManyInCache=function(t,e){this.dispatcher.upsertManyInCache(t,e)},t.prototype.setFilter=function(t){this.dispatcher.setFilter(t)},t.prototype.setLoaded=function(t){this.dispatcher.setLoaded(!!t)},t.prototype.setLoading=function(t){this.dispatcher.setLoading(!!t)},t}(),_t=function(){function t(t){this.entityDefinitionService=t}return t.prototype.create=function(t){var e=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return e&&e.initialState||ft(t)},e.__decorate([r.Injectable(),e.__param(0,r.Optional()),e.__metadata("design:paramtypes",[H])],t)}();function ft(t){return{entityName:t,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}var St,vt=function(){function t(t,e){this.entityCollectionCreator=t||new _t,this.selectEntityCache=e||ut("entityCache")}return t.prototype.createCollectionSelector=function(t){var e=this;return o.createSelector(this.selectEntityCache,(function(r){return void 0===r&&(r={}),r[t]||e.entityCollectionCreator.create(t)}))},t.prototype.createCollectionSelectors=function(t){var r="string"==typeof t?{entityName:t}:t,n=function(t){return t.ids},i=function(t){return t.entities},a=o.createSelector(n,i,(function(t,e){return t.map((function(t){return e[t]}))})),s=o.createSelector(n,(function(t){return t.length})),c=function(t){return t.filter},p=r.filterFn,u=p?o.createSelector(a,c,(function(t,e){return p(t,e)})):a,h={};return Object.keys(r.additionalCollectionState||{}).forEach((function(t){h["select"+t[0].toUpperCase()+t.slice(1)]=function(e){return e[t]}})),e.__assign({selectCount:s,selectEntities:a,selectEntityMap:i,selectFilter:c,selectFilteredEntities:u,selectKeys:n,selectLoaded:function(t){return t.loaded},selectLoading:function(t){return t.loading},selectChangeState:function(t){return t.changeState}},h)},t.prototype.create=function(t){var r="string"==typeof t?{entityName:t}:t,n=r.entityName,i=this.createCollectionSelector(n),a=this.createCollectionSelectors(r),s={};return Object.keys(a).forEach((function(t){s[t]=o.createSelector(i,a[t])})),e.__assign({entityName:n,selectCollection:i,selectEntityCache:this.selectEntityCache},s)},e.__decorate([r.Injectable(),e.__param(0,r.Optional()),e.__param(1,r.Optional()),e.__param(1,r.Inject(ct)),e.__metadata("design:paramtypes",[_t,Function])],t)}(),mt=function(){function t(t,e,r){this.store=t,this.actions=e,this.selectEntityCache=r,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=e.pipe(n.filter((function(t){return t.payload&&t.payload.entityOp&&t.payload.entityOp.endsWith("/error")})),n.shareReplay(1))}return t.prototype.create=function(t,e){var r=this,n={entityName:t};return Object.keys(e).forEach((function(t){if(t.startsWith("select")){var i=t[6].toLowerCase()+t.substr(7)+"$";n[i]=r.store.select(e[t])}})),n.entityActions$=this.actions.pipe(g(t)),n.errors$=this.entityActionErrors$.pipe(g(t)),n},e.__decorate([r.Injectable(),e.__param(2,r.Inject(ct)),e.__metadata("design:paramtypes",[o.Store,c.Actions,Function])],t)}(),Ot=function(){function t(t,e,r,n){this.entityDispatcherFactory=t,this.entityDefinitionService=e,this.entitySelectorsFactory=r,this.entitySelectors$Factory=n}return t.prototype.create=function(t){t=t.trim();var e=this.entityDefinitionService.getDefinition(t),r=this.entityDispatcherFactory.create(t,e.selectId,e.entityDispatcherOptions),n=this.entitySelectorsFactory.create(e.metadata);return{dispatcher:r,entityName:t,selectors:n,selectors$:this.entitySelectors$Factory.create(t,n)}},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[ht,H,vt,mt])],t)}(),At=function(){function t(t){this.entityCollectionServiceElementsFactory=t}return t.prototype.create=function(t){return new gt(t,this.entityCollectionServiceElementsFactory)},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[Ot])],t)}(),Ct=e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[At,ht,mt,o.Store])],(function Ct(t,e,r,n){this.entityCollectionServiceFactory=t,this.store=n,this.entityActionErrors$=r.entityActionErrors$,this.entityCache$=r.entityCache$,this.reducedActions$=e.reducedActions$})),Tt=function(){function t(t){this.entityServicesElements=t,this.EntityCollectionServices={}}return Object.defineProperty(t.prototype,"entityActionErrors$",{get:function(){return this.entityServicesElements.entityActionErrors$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCache$",{get:function(){return this.entityServicesElements.entityCache$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCollectionServiceFactory",{get:function(){return this.entityServicesElements.entityCollectionServiceFactory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reducedActions$",{get:function(){return this.entityServicesElements.reducedActions$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"store",{get:function(){return this.entityServicesElements.store},enumerable:!0,configurable:!0}),t.prototype.dispatch=function(t){this.store.dispatch(t)},t.prototype.createEntityCollectionService=function(t){return this.entityCollectionServiceFactory.create(t)},t.prototype.getEntityCollectionService=function(t){var e=this.EntityCollectionServices[t];return e||(e=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=e),e},t.prototype.registerEntityCollectionService=function(t,e){this.EntityCollectionServices[e||t.entityName]=t},t.prototype.registerEntityCollectionServices=function(t){var e=this;Array.isArray(t)?t.forEach((function(t){return e.registerEntityCollectionService(t)})):Object.keys(t||{}).forEach((function(r){e.registerEntityCollectionService(t[r],r)}))},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[Ct])],t)}(),Dt=function Dt(){};(St=t.ChangeType||(t.ChangeType={}))[St.Unchanged=0]="Unchanged",St[St.Added=1]="Added",St[St.Deleted=2]="Deleted",St[St.Updated=3]="Updated";var Rt=function(){function r(t,e){this.adapter=t,this.selectId=e,this.selectId=e||y}return r.prototype.commitAll=function(t){return 0===Object.keys(t.changeState).length?t:e.__assign(e.__assign({},t),{changeState:{}})},r.prototype.commitMany=function(t,r){var n=this;if(null==t||0===t.length)return r;var i=!1,a=t.reduce((function(t,r){var a="object"==typeof r?n.selectId(r):r;return t[a]&&(i||(t=e.__assign({},t),i=!0),delete t[a]),t}),r.changeState);return i?e.__assign(e.__assign({},r),{changeState:a}):r},r.prototype.commitOne=function(t,e){return null==t?e:this.commitMany([t],e)},r.prototype.mergeQueryResults=function(e,r,n){return this.mergeServerUpserts(e,r,t.MergeStrategy.PreserveChanges,n)},r.prototype.mergeSaveAdds=function(e,r,n){return this.mergeServerUpserts(e,r,t.MergeStrategy.OverwriteChanges,n)},r.prototype.mergeSaveDeletes=function(e,r,n){var i=e;return r=(n=null==n?t.MergeStrategy.OverwriteChanges:n)===t.MergeStrategy.IgnoreChanges?r:this.commitMany(i,r),this.adapter.removeMany(i,r)},r.prototype.mergeSaveUpdates=function(r,n,i,a){var s=this;if(void 0===a&&(a=!1),null==r||0===r.length)return n;var o,c=!1,p=n.changeState;switch(i=null==i?t.MergeStrategy.OverwriteChanges:i){case t.MergeStrategy.IgnoreChanges:return o=h(r),this.adapter.updateMany(o,n);case t.MergeStrategy.OverwriteChanges:return p=r.reduce((function(t,r){var n=r.id;return t[n]&&(c||(t=e.__assign({},t),c=!0),delete t[n]),t}),n.changeState),n=c?e.__assign(e.__assign({},n),{changeState:p}):n,o=h(r),this.adapter.updateMany(o,n);case t.MergeStrategy.PreserveChanges:var u=[];return p=r.reduce((function(t,r){var n=r.id,i=t[n];if(i){c||(t=e.__assign({},t),c=!0);var a=s.selectId(r.changes),o=i;a!==n&&delete t[n];var p=e.__assign(e.__assign({},o.originalValue),r.changes);t[a]=e.__assign(e.__assign({},o),{originalValue:p})}else u.push(r);return t}),n.changeState),n=c?e.__assign(e.__assign({},n),{changeState:p}):n,o=h(u),this.adapter.updateMany(o,n)}function h(t){return!0===a&&(t=t.filter((function(t){return!0===t.changed}))),t.map((function(t){return{id:t.id,changes:t.changes}}))}},r.prototype.mergeSaveUpserts=function(e,r,n){return this.mergeServerUpserts(e,r,t.MergeStrategy.OverwriteChanges,n)},r.prototype.mergeServerUpserts=function(r,n,i,a){var s=this;if(null==r||0===r.length)return n;var o=!1,c=n.changeState;switch(a=null==a?i:a){case t.MergeStrategy.IgnoreChanges:return this.adapter.upsertMany(r,n);case t.MergeStrategy.OverwriteChanges:return n=this.adapter.upsertMany(r,n),c=r.reduce((function(t,r){var n=s.selectId(r);return t[n]&&(o||(t=e.__assign({},t),o=!0),delete t[n]),t}),n.changeState),o?e.__assign(e.__assign({},n),{changeState:c}):n;case t.MergeStrategy.PreserveChanges:var p=[];return c=r.reduce((function(t,r){var n,i=s.selectId(r);return t[i]?o||(t=e.__assign(e.__assign({},t),((n={})[i]=e.__assign(e.__assign({},t[i]),{originalValue:r}),n)),o=!0):p.push(r),t}),n.changeState),n=this.adapter.upsertMany(p,n),o?e.__assign(e.__assign({},n),{changeState:c}):n}},r.prototype.trackAddMany=function(r,n,i){var a=this;if(i===t.MergeStrategy.IgnoreChanges||null==r||0===r.length)return n;var s=!1,o=r.reduce((function(r,i){var o=a.selectId(i);if(null==o||""===o)throw new Error(n.entityName+" entity add requires a key to be tracked");return r[o]||(s||(s=!0,r=e.__assign({},r)),r[o]={changeType:t.ChangeType.Added}),r}),n.changeState);return s?e.__assign(e.__assign({},n),{changeState:o}):n},r.prototype.trackAddOne=function(t,e,r){return null==t?e:this.trackAddMany([t],e,r)},r.prototype.trackDeleteMany=function(r,n,i){if(i===t.MergeStrategy.IgnoreChanges||null==r||0===r.length)return n;var a=!1,s=n.entities,o=r.reduce((function(r,n){var i=s[n];if(i){var o=r[n];o?o.changeType===t.ChangeType.Added?(c(),delete r[n]):o.changeType===t.ChangeType.Updated&&(c(),o.changeType=t.ChangeType.Deleted):(c(),r[n]={changeType:t.ChangeType.Deleted,originalValue:i})}return r;function c(){a||(a=!0,r=e.__assign({},r))}}),n.changeState);return a?e.__assign(e.__assign({},n),{changeState:o}):n},r.prototype.trackDeleteOne=function(t,e,r){return null==t?e:this.trackDeleteMany([t],e,r)},r.prototype.trackUpdateMany=function(r,n,i){if(i===t.MergeStrategy.IgnoreChanges||null==r||0===r.length)return n;var a=!1,s=n.entities,o=r.reduce((function(r,i){var o=i.id;if(null==o||""===o)throw new Error(n.entityName+" entity update requires a key to be tracked");var c=s[o];return c&&(r[o]||(a||(a=!0,r=e.__assign({},r)),r[o]={changeType:t.ChangeType.Updated,originalValue:c})),r}),n.changeState);return a?e.__assign(e.__assign({},n),{changeState:o}):n},r.prototype.trackUpdateOne=function(t,e,r){return null==t?e:this.trackUpdateMany([t],e,r)},r.prototype.trackUpsertMany=function(r,n,i){var a=this;if(i===t.MergeStrategy.IgnoreChanges||null==r||0===r.length)return n;var s=!1,o=n.entities,c=r.reduce((function(r,i){var c=a.selectId(i);if(null==c||""===c)throw new Error(n.entityName+" entity upsert requires a key to be tracked");if(!r[c]){s||(s=!0,r=e.__assign({},r));var p=o[c];r[c]=null==p?{changeType:t.ChangeType.Added}:{changeType:t.ChangeType.Updated,originalValue:p}}return r}),n.changeState);return s?e.__assign(e.__assign({},n),{changeState:c}):n},r.prototype.trackUpsertOne=function(t,e,r){return null==t?e:this.trackUpsertMany([t],e,r)},r.prototype.undoAll=function(r){var n=Object.keys(r.changeState).reduce((function(e,r){var n=e.chgState[r];switch(n.changeType){case t.ChangeType.Added:e.remove.push(r);break;case t.ChangeType.Deleted:var i=n.originalValue;i&&e.upsert.push(i);break;case t.ChangeType.Updated:e.upsert.push(n.originalValue)}return e}),{remove:[],upsert:[],chgState:r.changeState}),i=n.upsert;return r=this.adapter.removeMany(n.remove,r),r=this.adapter.upsertMany(i,r),e.__assign(e.__assign({},r),{changeState:{}})},r.prototype.undoMany=function(r,n){var i=this;if(null==r||0===r.length)return n;var a=!1,s=r.reduce((function(r,n){var s=r.changeState,o="object"==typeof n?i.selectId(n):n,c=s[o];if(c)switch(a||(s=e.__assign({},s),a=!0),delete s[o],r.changeState=s,c.changeType){case t.ChangeType.Added:r.remove.push(o);break;case t.ChangeType.Deleted:var p=c.originalValue;p&&r.upsert.push(p);break;case t.ChangeType.Updated:r.upsert.push(c.originalValue)}return r}),{remove:[],upsert:[],changeState:n.changeState}),o=s.changeState,c=s.upsert;return n=this.adapter.removeMany(s.remove,n),n=this.adapter.upsertMany(c,n),a?e.__assign(e.__assign({},n),{changeState:o}):n},r.prototype.undoOne=function(t,e){return null==t?e:this.undoMany([t],e)},r}(),Mt=function(){function r(e,r,n){var i;this.entityName=e,this.definition=r,this.methods=((i={})[t.EntityOp.CANCEL_PERSIST]=this.cancelPersist.bind(this),i[t.EntityOp.QUERY_ALL]=this.queryAll.bind(this),i[t.EntityOp.QUERY_ALL_ERROR]=this.queryAllError.bind(this),i[t.EntityOp.QUERY_ALL_SUCCESS]=this.queryAllSuccess.bind(this),i[t.EntityOp.QUERY_BY_KEY]=this.queryByKey.bind(this),i[t.EntityOp.QUERY_BY_KEY_ERROR]=this.queryByKeyError.bind(this),i[t.EntityOp.QUERY_BY_KEY_SUCCESS]=this.queryByKeySuccess.bind(this),i[t.EntityOp.QUERY_LOAD]=this.queryLoad.bind(this),i[t.EntityOp.QUERY_LOAD_ERROR]=this.queryLoadError.bind(this),i[t.EntityOp.QUERY_LOAD_SUCCESS]=this.queryLoadSuccess.bind(this),i[t.EntityOp.QUERY_MANY]=this.queryMany.bind(this),i[t.EntityOp.QUERY_MANY_ERROR]=this.queryManyError.bind(this),i[t.EntityOp.QUERY_MANY_SUCCESS]=this.queryManySuccess.bind(this),i[t.EntityOp.SAVE_ADD_MANY]=this.saveAddMany.bind(this),i[t.EntityOp.SAVE_ADD_MANY_ERROR]=this.saveAddManyError.bind(this),i[t.EntityOp.SAVE_ADD_MANY_SUCCESS]=this.saveAddManySuccess.bind(this),i[t.EntityOp.SAVE_ADD_ONE]=this.saveAddOne.bind(this),i[t.EntityOp.SAVE_ADD_ONE_ERROR]=this.saveAddOneError.bind(this),i[t.EntityOp.SAVE_ADD_ONE_SUCCESS]=this.saveAddOneSuccess.bind(this),i[t.EntityOp.SAVE_DELETE_MANY]=this.saveDeleteMany.bind(this),i[t.EntityOp.SAVE_DELETE_MANY_ERROR]=this.saveDeleteManyError.bind(this),i[t.EntityOp.SAVE_DELETE_MANY_SUCCESS]=this.saveDeleteManySuccess.bind(this),i[t.EntityOp.SAVE_DELETE_ONE]=this.saveDeleteOne.bind(this),i[t.EntityOp.SAVE_DELETE_ONE_ERROR]=this.saveDeleteOneError.bind(this),i[t.EntityOp.SAVE_DELETE_ONE_SUCCESS]=this.saveDeleteOneSuccess.bind(this),i[t.EntityOp.SAVE_UPDATE_MANY]=this.saveUpdateMany.bind(this),i[t.EntityOp.SAVE_UPDATE_MANY_ERROR]=this.saveUpdateManyError.bind(this),i[t.EntityOp.SAVE_UPDATE_MANY_SUCCESS]=this.saveUpdateManySuccess.bind(this),i[t.EntityOp.SAVE_UPDATE_ONE]=this.saveUpdateOne.bind(this),i[t.EntityOp.SAVE_UPDATE_ONE_ERROR]=this.saveUpdateOneError.bind(this),i[t.EntityOp.SAVE_UPDATE_ONE_SUCCESS]=this.saveUpdateOneSuccess.bind(this),i[t.EntityOp.SAVE_UPSERT_MANY]=this.saveUpsertMany.bind(this),i[t.EntityOp.SAVE_UPSERT_MANY_ERROR]=this.saveUpsertManyError.bind(this),i[t.EntityOp.SAVE_UPSERT_MANY_SUCCESS]=this.saveUpsertManySuccess.bind(this),i[t.EntityOp.SAVE_UPSERT_ONE]=this.saveUpsertOne.bind(this),i[t.EntityOp.SAVE_UPSERT_ONE_ERROR]=this.saveUpsertOneError.bind(this),i[t.EntityOp.SAVE_UPSERT_ONE_SUCCESS]=this.saveUpsertOneSuccess.bind(this),i[t.EntityOp.ADD_ALL]=this.addAll.bind(this),i[t.EntityOp.ADD_MANY]=this.addMany.bind(this),i[t.EntityOp.ADD_ONE]=this.addOne.bind(this),i[t.EntityOp.REMOVE_ALL]=this.removeAll.bind(this),i[t.EntityOp.REMOVE_MANY]=this.removeMany.bind(this),i[t.EntityOp.REMOVE_ONE]=this.removeOne.bind(this),i[t.EntityOp.UPDATE_MANY]=this.updateMany.bind(this),i[t.EntityOp.UPDATE_ONE]=this.updateOne.bind(this),i[t.EntityOp.UPSERT_MANY]=this.upsertMany.bind(this),i[t.EntityOp.UPSERT_ONE]=this.upsertOne.bind(this),i[t.EntityOp.COMMIT_ALL]=this.commitAll.bind(this),i[t.EntityOp.COMMIT_MANY]=this.commitMany.bind(this),i[t.EntityOp.COMMIT_ONE]=this.commitOne.bind(this),i[t.EntityOp.UNDO_ALL]=this.undoAll.bind(this),i[t.EntityOp.UNDO_MANY]=this.undoMany.bind(this),i[t.EntityOp.UNDO_ONE]=this.undoOne.bind(this),i[t.EntityOp.SET_CHANGE_STATE]=this.setChangeState.bind(this),i[t.EntityOp.SET_COLLECTION]=this.setCollection.bind(this),i[t.EntityOp.SET_FILTER]=this.setFilter.bind(this),i[t.EntityOp.SET_LOADED]=this.setLoaded.bind(this),i[t.EntityOp.SET_LOADING]=this.setLoading.bind(this),i),this.adapter=r.entityAdapter,this.isChangeTracking=!0!==r.noChangeTracking,this.selectId=r.selectId,this.guard=new h(e,this.selectId),this.toUpdate=l(this.selectId),this.entityChangeTracker=n||new Rt(this.adapter,this.selectId)}return r.prototype.cancelPersist=function(t){return this.setLoadingFalse(t)},r.prototype.queryAll=function(t){return this.setLoadingTrue(t)},r.prototype.queryAllError=function(t,e){return this.setLoadingFalse(t)},r.prototype.queryAllSuccess=function(t,r){var n=this.extractData(r),i=this.extractMergeStrategy(r);return e.__assign(e.__assign({},this.entityChangeTracker.mergeQueryResults(n,t,i)),{loaded:!0,loading:!1})},r.prototype.queryByKey=function(t,e){return this.setLoadingTrue(t)},r.prototype.queryByKeyError=function(t,e){return this.setLoadingFalse(t)},r.prototype.queryByKeySuccess=function(t,e){var r=this.extractData(e),n=this.extractMergeStrategy(e);return t=null==r?t:this.entityChangeTracker.mergeQueryResults([r],t,n),this.setLoadingFalse(t)},r.prototype.queryLoad=function(t){return this.setLoadingTrue(t)},r.prototype.queryLoadError=function(t,e){return this.setLoadingFalse(t)},r.prototype.queryLoadSuccess=function(t,r){var n=this.extractData(r);return e.__assign(e.__assign({},this.adapter.addAll(n,t)),{loading:!1,loaded:!0,changeState:{}})},r.prototype.queryMany=function(t,e){return this.setLoadingTrue(t)},r.prototype.queryManyError=function(t,e){return this.setLoadingFalse(t)},r.prototype.queryManySuccess=function(t,r){var n=this.extractData(r),i=this.extractMergeStrategy(r);return e.__assign(e.__assign({},this.entityChangeTracker.mergeQueryResults(n,t,i)),{loading:!1})},r.prototype.saveAddMany=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackAddMany(r,t,n),t=this.adapter.addMany(r,t)}return this.setLoadingTrue(t)},r.prototype.saveAddManyError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveAddManySuccess=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.isOptimistic(e)?this.entityChangeTracker.mergeSaveUpserts(r,t,n):this.entityChangeTracker.mergeSaveAdds(r,t,n),this.setLoadingFalse(t)},r.prototype.saveAddOne=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackAddOne(r,t,n),t=this.adapter.addOne(r,t)}return this.setLoadingTrue(t)},r.prototype.saveAddOneError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveAddOneSuccess=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);if(this.isOptimistic(e)){var i=this.toUpdate(r);t=this.entityChangeTracker.mergeSaveUpdates([i],t,n,!1)}else t=this.entityChangeTracker.mergeSaveAdds([r],t,n);return this.setLoadingFalse(t)},r.prototype.saveDeleteOne=function(e,r){var n=this.extractData(r),i="object"==typeof n?this.selectId(n):n,a=e.changeState[i];if(a&&(a.changeType===t.ChangeType.Added?(e=this.adapter.removeOne(i,e),e=this.entityChangeTracker.commitOne(i,e),r.payload.skip=!0):e=this.entityChangeTracker.trackDeleteOne(i,e)),this.isOptimistic(r)){var s=this.extractMergeStrategy(r);e=this.entityChangeTracker.trackDeleteOne(i,e,s),e=this.adapter.removeOne(i,e)}return this.setLoadingTrue(e)},r.prototype.saveDeleteOneError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveDeleteOneSuccess=function(t,e){var r=this.extractData(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.mergeSaveDeletes([r],t,n)}else t=this.adapter.removeOne(r,t),t=this.entityChangeTracker.commitOne(r,t);return this.setLoadingFalse(t)},r.prototype.saveDeleteMany=function(e,r){var n=this,i=this.extractData(r).map((function(t){return"object"==typeof t?n.selectId(t):t}));if(i.forEach((function(i){var a=e.changeState[i];a&&(a.changeType===t.ChangeType.Added?(e=n.adapter.removeOne(i,e),e=n.entityChangeTracker.commitOne(i,e),r.payload.skip=!0):e=n.entityChangeTracker.trackDeleteOne(i,e))})),this.isOptimistic(r)){var a=this.extractMergeStrategy(r);e=this.entityChangeTracker.trackDeleteMany(i,e,a),e=this.adapter.removeMany(i,e)}return this.setLoadingTrue(e)},r.prototype.saveDeleteManyError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveDeleteManySuccess=function(t,e){var r=this.extractData(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.mergeSaveDeletes(r,t,n)}else t=this.adapter.removeMany(r,t),t=this.entityChangeTracker.commitMany(r,t);return this.setLoadingFalse(t)},r.prototype.saveUpdateOne=function(t,e){var r=this.guard.mustBeUpdate(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpdateOne(r,t,n),t=this.adapter.updateOne(r,t)}return this.setLoadingTrue(t)},r.prototype.saveUpdateOneError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveUpdateOneSuccess=function(t,e){var r=this.guard.mustBeUpdateResponse(e),n=this.isOptimistic(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpdates([r],t,i,n),this.setLoadingFalse(t)},r.prototype.saveUpdateMany=function(t,e){var r=this.guard.mustBeUpdates(e);if(this.isOptimistic(e)){var n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpdateMany(r,t,n),t=this.adapter.updateMany(r,t)}return this.setLoadingTrue(t)},r.prototype.saveUpdateManyError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveUpdateManySuccess=function(t,e){var r=this.guard.mustBeUpdateResponses(e),n=(this.isOptimistic(e),this.extractMergeStrategy(e));return t=this.entityChangeTracker.mergeSaveUpdates(r,t,n,!1),this.setLoadingFalse(t)},r.prototype.saveUpsertOne=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpsertOne(r,t,n),t=this.adapter.upsertOne(r,t)}return this.setLoadingTrue(t)},r.prototype.saveUpsertOneError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveUpsertOneSuccess=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpserts([r],t,n),this.setLoadingFalse(t)},r.prototype.saveUpsertMany=function(t,e){if(this.isOptimistic(e)){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpsertMany(r,t,n),t=this.adapter.upsertMany(r,t)}return this.setLoadingTrue(t)},r.prototype.saveUpsertManyError=function(t,e){return this.setLoadingFalse(t)},r.prototype.saveUpsertManySuccess=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpserts(r,t,n),this.setLoadingFalse(t)},r.prototype.addAll=function(t,r){var n=this.guard.mustBeEntities(r);return e.__assign(e.__assign({},this.adapter.addAll(n,t)),{loading:!1,loaded:!0,changeState:{}})},r.prototype.addMany=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackAddMany(r,t,n),this.adapter.addMany(r,t)},r.prototype.addOne=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackAddOne(r,t,n),this.adapter.addOne(r,t)},r.prototype.removeMany=function(t,e){var r=this.guard.mustBeKeys(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackDeleteMany(r,t,n),this.adapter.removeMany(r,t)},r.prototype.removeOne=function(t,e){var r=this.guard.mustBeKey(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackDeleteOne(r,t,n),this.adapter.removeOne(r,t)},r.prototype.removeAll=function(t,r){return e.__assign(e.__assign({},this.adapter.removeAll(t)),{loaded:!1,loading:!1,changeState:{}})},r.prototype.updateMany=function(t,e){var r=this.guard.mustBeUpdates(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpdateMany(r,t,n),this.adapter.updateMany(r,t)},r.prototype.updateOne=function(t,e){var r=this.guard.mustBeUpdate(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpdateOne(r,t,n),this.adapter.updateOne(r,t)},r.prototype.upsertMany=function(t,e){var r=this.guard.mustBeEntities(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpsertMany(r,t,n),this.adapter.upsertMany(r,t)},r.prototype.upsertOne=function(t,e){var r=this.guard.mustBeEntity(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpsertOne(r,t,n),this.adapter.upsertOne(r,t)},r.prototype.commitAll=function(t){return this.entityChangeTracker.commitAll(t)},r.prototype.commitMany=function(t,e){return this.entityChangeTracker.commitMany(this.extractData(e),t)},r.prototype.commitOne=function(t,e){return this.entityChangeTracker.commitOne(this.extractData(e),t)},r.prototype.undoAll=function(t){return this.entityChangeTracker.undoAll(t)},r.prototype.undoMany=function(t,e){return this.entityChangeTracker.undoMany(this.extractData(e),t)},r.prototype.undoOne=function(t,e){return this.entityChangeTracker.undoOne(this.extractData(e),t)},r.prototype.setChangeState=function(t,r){var n=this.extractData(r);return t.changeState===n?t:e.__assign(e.__assign({},t),{changeState:n})},r.prototype.setCollection=function(t,e){var r=this.extractData(e);return t===r?t:r},r.prototype.setFilter=function(t,r){var n=this.extractData(r);return t.filter===n?t:e.__assign(e.__assign({},t),{filter:n})},r.prototype.setLoaded=function(t,r){var n=!0===this.extractData(r)||!1;return t.loaded===n?t:e.__assign(e.__assign({},t),{loaded:n})},r.prototype.setLoading=function(t,e){return this.setLoadingFlag(t,this.extractData(e))},r.prototype.setLoadingFalse=function(t){return this.setLoadingFlag(t,!1)},r.prototype.setLoadingTrue=function(t){return this.setLoadingFlag(t,!0)},r.prototype.setLoadingFlag=function(t,r){return t.loading===(r=!0===r)?t:e.__assign(e.__assign({},t),{loading:r})},r.prototype.extractData=function(t){return t.payload&&t.payload.data},r.prototype.extractMergeStrategy=function(e){return this.isChangeTracking?e.payload&&e.payload.mergeStrategy:t.MergeStrategy.IgnoreChanges},r.prototype.isOptimistic=function(t){return t.payload&&!0===t.payload.isOptimistic},r}(),Nt=function(){function t(t){this.entityDefinitionService=t}return t.prototype.create=function(t){var e=this.entityDefinitionService.getDefinition(t);return new Mt(t,e).methods},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[H])],t)}(),Ut=function(){function t(t){this.methodsFactory=t}return t.prototype.create=function(t){var e=this.methodsFactory.create(t);return function t(r,n){var i=e[n.payload.entityOp];return i?i(r,n):r}},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[Nt])],t)}(),It=function(){function t(t,e){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=o.compose.apply(null,e||[])}return t.prototype.getOrCreateReducer=function(t){var e=this.entityCollectionReducers[t];return e||(e=this.entityCollectionReducerFactory.create(t),e=this.registerReducer(t,e),this.entityCollectionReducers[t]=e),e},t.prototype.registerReducer=function(t,e){return e=this.entityCollectionMetaReducer(e),this.entityCollectionReducers[t.trim()]=e},t.prototype.registerReducers=function(t){var e=this;(t?Object.keys(t):[]).forEach((function(r){return e.registerReducer(r,t[r])}))},e.__decorate([r.Injectable(),e.__param(1,r.Optional()),e.__param(1,r.Inject(st)),e.__metadata("design:paramtypes",[Ut,Array])],t)}(),xt=function(){function n(t,e,r){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=e,this.logger=r}return n.prototype.create=function(){return function e(r,n){switch(void 0===r&&(r={}),n.type){case t.EntityCacheAction.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(r,n);case t.EntityCacheAction.LOAD_COLLECTIONS:return this.loadCollectionsReducer(r,n);case t.EntityCacheAction.MERGE_QUERY_SET:return this.mergeQuerySetReducer(r,n);case t.EntityCacheAction.SAVE_ENTITIES:return this.saveEntitiesReducer(r,n);case t.EntityCacheAction.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(r,n);case t.EntityCacheAction.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(r,n);case t.EntityCacheAction.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(r,n);case t.EntityCacheAction.SET_ENTITY_CACHE:return n.payload.cache}var i=n.payload;return i&&i.entityName&&i.entityOp&&!i.error?this.applyCollectionReducer(r,n):r}.bind(this)},n.prototype.clearCollectionsReducer=function(e,r){var n=this,i=r.payload.collections,a=t.EntityOp.REMOVE_ALL;return i||(i=Object.keys(e)),i.reduce((function(t,e){return n.applyCollectionReducer(t,{type:"["+e+"] "+r.type,payload:{entityName:e,entityOp:a}})}),e)},n.prototype.loadCollectionsReducer=function(e,r){var n=this,i=r.payload.collections,a=t.EntityOp.ADD_ALL;return Object.keys(i).reduce((function(t,e){return n.applyCollectionReducer(t,{type:"["+e+"] "+r.type,payload:{entityName:e,entityOp:a,data:i[e]}})}),e)},n.prototype.mergeQuerySetReducer=function(e,r){var n=this,i=r.payload,a=i.mergeStrategy,s=i.querySet;a=null===a?t.MergeStrategy.PreserveChanges:a;var o=t.EntityOp.UPSERT_MANY;return Object.keys(s).reduce((function(t,e){return n.applyCollectionReducer(t,{type:"["+e+"] "+r.type,payload:{entityName:e,entityOp:o,data:s[e],mergeStrategy:a}})}),e)},n.prototype.saveEntitiesReducer=function(e,r){var n=this,i=r.payload,a=i.changeSet,s=i.correlationId,o=i.isOptimistic,c=i.mergeStrategy,p=i.tag;try{a.changes.forEach((function(t){var i=t.entityName,a={entityName:i,entityOp:u(t),data:t.entities,correlationId:s,isOptimistic:o,mergeStrategy:c,tag:p},h={type:"["+i+"] "+r.type,payload:a};if(e=n.applyCollectionReducer(e,h),h.payload.error)throw h.payload.error}))}catch(t){r.payload.error=t}return e;function u(e){switch(e.op){case t.ChangeSetOperation.Add:return t.EntityOp.SAVE_ADD_MANY;case t.ChangeSetOperation.Delete:return t.EntityOp.SAVE_DELETE_MANY;case t.ChangeSetOperation.Update:return t.EntityOp.SAVE_UPDATE_MANY;case t.ChangeSetOperation.Upsert:return t.EntityOp.SAVE_UPSERT_MANY}}},n.prototype.saveEntitiesCancelReducer=function(t,e){return this.clearLoadingFlags(t,e.payload.entityNames||[])},n.prototype.saveEntitiesErrorReducer=function(t,e){var r=e.payload.originalAction.payload.changeSet.changes.map((function(t){return t.entityName}));return this.clearLoadingFlags(t,r)},n.prototype.saveEntitiesSuccessReducer=function(e,r){var n=this,i=r.payload,a=i.correlationId,s=i.isOptimistic,o=i.mergeStrategy,c=i.tag;return i.changeSet.changes.forEach((function(t){var i=t.entityName,u={entityName:i,entityOp:p(t),data:t.entities,correlationId:a,isOptimistic:s,mergeStrategy:o,tag:c};e=n.applyCollectionReducer(e,{type:"["+i+"] "+r.type,payload:u})})),e;function p(e){switch(e.op){case t.ChangeSetOperation.Add:return t.EntityOp.SAVE_ADD_MANY_SUCCESS;case t.ChangeSetOperation.Delete:return t.EntityOp.SAVE_DELETE_MANY_SUCCESS;case t.ChangeSetOperation.Update:return t.EntityOp.SAVE_UPDATE_MANY_SUCCESS;case t.ChangeSetOperation.Upsert:return t.EntityOp.SAVE_UPSERT_MANY_SUCCESS}}},n.prototype.applyCollectionReducer=function(t,r){var n;void 0===t&&(t={});var i,a=r.payload.entityName,s=t[a],o=this.entityCollectionReducerRegistry.getOrCreateReducer(a);try{i=o(s||this.entityCollectionCreator.create(a),r)}catch(t){this.logger.error(t),r.payload.error=t}return r.payload.error||s===i?t:e.__assign(e.__assign({},t),((n={})[a]=i,n))},n.prototype.clearLoadingFlags=function(t,r){var n=!1;return r.forEach((function(r){var i=t[r];i.loading&&(n||(t=e.__assign({},t),n=!0),t[r]=e.__assign(e.__assign({},i),{loading:!1}))})),t},e.__decorate([r.Injectable(),e.__metadata("design:paramtypes",[_t,It,w])],n)}(),Lt=function(){function t(){}return t.prototype.error=function(t,e){t&&(e?console.error(t,e):console.error(t))},t.prototype.log=function(t,e){t&&(e?console.log(t,e):console.log(t))},t.prototype.warn=function(t,e){t&&(e?console.warn(t,e):console.warn(t))},e.__decorate([r.Injectable()],t)}(),bt=["equipment","information","money","series"],kt=function(){function t(t){var e=this;this.pluralNames={},t&&t.forEach((function(t){return e.registerPluralNames(t)}))}return t.prototype.pluralize=function(t){return this.pluralNames[t]||(bt.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")},t.prototype.registerPluralNames=function(t){this.pluralNames=e.__assign(e.__assign({},this.pluralNames),t||{})},e.__decorate([r.Injectable(),e.__param(0,r.Optional()),e.__param(0,r.Inject(Y)),e.__metadata("design:paramtypes",[Array])],t)}();function wt(){return"xxxxxxxxxx4xxyxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}var Yt=function(){function t(t,e,n,i,a,s){this.reducerManager=t,this.injector=n,this.entityCacheName=i,this.initialState=a,this.metaReducers=s;var c=i||"entityCache";a="function"==typeof a?a():a;var p=(s||[]).map((function(t){return t instanceof r.InjectionToken?n.get(t):t}));this.entityCacheFeature={key:c,reducers:e.create(),reducerFactory:o.combineReducers,initialState:a||{},metaReducers:p},t.addFeature(this.entityCacheFeature)}var n;return n=t,t.forRoot=function(t){return{ngModule:n,providers:[{provide:at,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:st,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:Y,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}},t.prototype.ngOnDestroy=function(){this.reducerManager.removeFeature(this.entityCacheFeature)},n=e.__decorate([r.NgModule({imports:[o.StoreModule],providers:[Z,tt,u,rt,xt,pt,_t,Ut,Nt,It,Ot,At,H,ht,vt,mt,Ct,{provide:it,useValue:"entityCache"},{provide:Dt,useClass:Tt},{provide:w,useClass:Lt}]}),e.__param(3,r.Optional()),e.__param(3,r.Inject(it)),e.__param(4,r.Optional()),e.__param(4,r.Inject(ot)),e.__param(5,r.Optional()),e.__param(5,r.Inject(at)),e.__metadata("design:paramtypes",[o.ReducerManager,xt,r.Injector,String,Object,Array])],t)}(),Vt=function(){function t(t,e,r){this.effectSources=t,this.addEffects(e),this.addEffects(r)}var n;return n=t,t.forRoot=function(t){return{ngModule:n,providers:[{provide:K,multi:!0,useValue:t.entityMetadata?t.entityMetadata:[]},{provide:at,useValue:t.entityCacheMetaReducers?t.entityCacheMetaReducers:[]},{provide:st,useValue:t.entityCollectionMetaReducers?t.entityCollectionMetaReducers:[]},{provide:Y,multi:!0,useValue:t.pluralNames?t.pluralNames:{}}]}},t.prototype.addEffects=function(t){this.effectSources.addEffects(t)},n=e.__decorate([r.NgModule({imports:[Yt,c.EffectsModule],providers:[Q,W,z,dt,Et,{provide:$,useClass:P},{provide:J,useClass:X},{provide:V,useClass:kt}]}),e.__metadata("design:paramtypes",[c.EffectSources,dt,Et])],t)}();t.ChangeSetItemFactory=S,t.ClearCollections=A,t.CorrelationIdGenerator=Z,t.DataServiceError=b,t.DefaultDataService=B,t.DefaultDataServiceConfig=k,t.DefaultDataServiceFactory=Q,t.DefaultHttpUrlGenerator=P,t.DefaultLogger=Lt,t.DefaultPersistenceResultHandler=X,t.DefaultPluralizer=kt,t.ENTITY_CACHE_META_REDUCERS=at,t.ENTITY_CACHE_NAME="entityCache",t.ENTITY_CACHE_NAME_TOKEN=it,t.ENTITY_CACHE_SELECTOR_TOKEN=ct,t.ENTITY_COLLECTION_META_REDUCERS=st,t.ENTITY_METADATA_TOKEN=K,t.EntityActionFactory=u,t.EntityActionGuard=h,t.EntityCacheDataService=W,t.EntityCacheDispatcher=rt,t.EntityCacheEffects=dt,t.EntityCacheReducerFactory=xt,t.EntityChangeTrackerBase=Rt,t.EntityCollectionCreator=_t,t.EntityCollectionReducerFactory=Ut,t.EntityCollectionReducerMethods=Mt,t.EntityCollectionReducerMethodsFactory=Nt,t.EntityCollectionReducerRegistry=It,t.EntityCollectionServiceBase=gt,t.EntityCollectionServiceElementsFactory=Ot,t.EntityCollectionServiceFactory=At,t.EntityDataModule=Vt,t.EntityDataModuleWithoutEffects=Yt,t.EntityDataService=z,t.EntityDefinitionService=H,t.EntityDispatcherBase=nt,t.EntityDispatcherDefaultOptions=tt,t.EntityDispatcherFactory=ht,t.EntityEffects=Et,t.EntityHttpResourceUrls=F,t.EntitySelectors$Factory=mt,t.EntitySelectorsFactory=vt,t.EntityServices=Dt,t.EntityServicesBase=Tt,t.EntityServicesElements=Ct,t.HttpUrlGenerator=$,t.INITIAL_ENTITY_CACHE_STATE=ot,t.LoadCollections=C,t.Logger=w,t.MergeQuerySet=T,t.OP_ERROR="/error",t.OP_SUCCESS="/success",t.PLURAL_NAMES_TOKEN=Y,t.PersistanceCanceled=et,t.PersistenceResultHandler=J,t.Pluralizer=V,t.PropsFilterFnFactory=function Ft(t){return void 0===t&&(t=[]),0===t.length?function(t,e){return t}:function(e,r){if(!e)return[];var n="string"==typeof r?new RegExp(r,"i"):r;return n?e.filter((function(e){return t.some((function(t){return n.test(e[t])}))})):e}},t.SaveEntities=R,t.SaveEntitiesCancel=M,t.SaveEntitiesCanceled=N,t.SaveEntitiesError=U,t.SaveEntitiesSuccess=I,t.SetEntityCache=D,t.changeSetItemFactory=v,t.createEmptyEntityCollection=ft,t.createEntityCacheSelector=ut,t.createEntityDefinition=q,t.defaultSelectId=y,t.entityCacheSelectorProvider=pt,t.excludeEmptyChangeSetItems=m,t.flattenArgs=d,t.getGuid=function $t(){return wt()},t.getGuidComb=function Pt(t){var e=("00"+(t||(new Date).getTime()).toString(16)).slice(-12);return"xxxxxxxxxx4xxyxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))+e},t.getUuid=wt,t.guidComparer=function jt(t,e){var r=t.slice(-12),n=e.slice(-12);return r!==n?r<n?-1:+(r!==n):t<e?-1:+(t!==e)},t.makeErrorOp=x,t.makeSuccessOp=L,t.normalizeRoot=j,t.ofEntityOp=E,t.ofEntityType=g,t.persistOps=lt,t.toUpdateFactory=l,t.ɵngrx_modules_data_data_a=yt,Object.defineProperty(t,"__esModule",{value:!0})}));